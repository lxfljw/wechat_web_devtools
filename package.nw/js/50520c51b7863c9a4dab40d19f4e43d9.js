'use strict';!function(require,directRequire){async function a(a,b=()=>{}){return new Promise(async(d,e)=>{try{const e=Date.now(),f=[...a];b('compilejs',h.config.PROCESSING.format(a[0].file));const i=await Promise.all(a.map((a)=>g({taskName:'processJS',config:{projectPath:a.projectPath,file:a.file,es6:a.es6?'yes':'no',minified:a.minified?'yes':'no',sourceMaps:'map',uglifyFileName:a.uglifyFileName?'yes':'no',nameMapping:JSON.stringify(a.nameMapping),sourceFileName:c.basename(a.file)},dataStr:a.code,maxTimeout:180000,useBackup:!0,downgrade:!1,showInStatus:{text:`compiling ${a.file}`},onAfterRun:()=>{const c=f.findIndex((b)=>b===a);0<=c&&f.splice(c,1),f[0]&&b('compilejs',h.config.PROCESSING.format(f[0].file))}})));console.log(`compilejs all files cost time: ${Date.now()-e}`),d(i)}catch(a){a instanceof Error?e(a):e(new Error(a))}})}const b=require('fs'),c=require('path'),d=require('mkdir-p'),e=require('./162bf2ee28b76d3b3d95b685cede4146.js'),f=require('./48679210e49dc5028a8b6642263eba75.js'),g=require('./41168dca39589e852da6631126d0f94d.js'),h=require('./common/locales/index.js'),i=require('./cdbf7243dc99f8461acbb1d57af1d8ae.js'),j=require('./84b183688a46c9e2626d3e6f83365e13.js'),{uglifyFileNames:k}=require('./890791d99e6d0eadf6a5a73d8d797338.js'),l=require('./1c8a8c710417d102ab574145dc51b4b0.js'),{bufToUTF8:m}=require('./efc820e1b92d6e4063535296d4a24213.js'),{FILE_NOT_UTF8:n}=require('./949d8235c744ced2a80121e4dba34c28.js'),o={};module.exports=function(g,p={}){o[g.hash]||(o[g.hash]={});const q=o[g.hash],r=p.onProgressUpdate||function(){},s=p.onFilesIgnored||function(){};return new Promise(async(o,t)=>{const{es6:u,minified:v,uglifyFileName:w}=g.setting,x=await f(g),y=x.openDataContext||x.subContext,{distPath:z}=p,A=await e(g),B=(g.packOptions||{}).ignore||[],C=A.getAllJSFiles().filter((a)=>!l.isFileIgnored(a,B));let D={};if(w){const a=[{type:'file',value:'game.js'},{type:'regex',value:/\/miniprogram_npm\/|^miniprogram_npm\//}];let b=[];x.subPackages&&x.subPackages.forEach((d)=>{const e=d.root.replace(/^\//,'');/\.js$/.test(e)?(a.push({type:'file',value:e}),b.push(c.posix.dirname(e))):(a.push({type:'file',value:c.posix.join(e,'./game.js')}),b.push(e))}),x.openDataContext&&(a.push({type:'file',value:c.posix.join(x.openDataContext,'index.js')}),b.push(x.openDataContext)),D=await k(C,a,b)}const E=w&&D&&0<Object.keys(D).length;const F=[],G=[];for(let a=0,b=C.length;a<b;a++){const b=C[a],d=A.getFile(b,null),e=m(d);if(void 0===e){const a=new Error(h.config.FILE_NOT_UTF8.format(b));return a.code=n,t(a)}const f=Date.now(),g=j.generateMD5(e),k=`${b}_${u}_${v}_${w}`;if(q[k]&&q[k].md5===g)console.log('compile js',b,'in cache, skip.');else if((u||v||E)&&512000>e.length)F.push({projectPath:A.srcPath,file:b,code:e,es6:u,minified:v,md5:g,uglifyFileName:w,nameMapping:D});else{let a,d=i(c.join(A.srcPath,b),e);if(d)try{'string'==typeof d&&(d=JSON.parse(d)),d=await i.insertSourcesContent(d,c.join(A.srcPath,b)),d=await i.rewriteSourcesIfNeeded(d,'game:///',[b]),a=JSON.stringify(d)}catch(a){d=null}q[k]={md5:g,jsCode:e,map:a||JSON.stringify(d),ignored:(u||v||E)&&512000<=e.length}}}if(0<F.length){let b=[];try{b=await a(F,r)}catch(a){return t(a)}for(let a=0,d=F.length;a<d;a++){if(b[a].error){const c=b[a].error,d=new Error(c.message);return d.code=c.code,t(d)}const{file:d,md5:e}=F[a];let f=b[a].map;try{'string'==typeof f&&(f=JSON.parse(f)),f=await i.insertSourcesContent(f,c.join(A.srcPath,d)),f=await i.rewriteSourcesIfNeeded(f,'game:///',[d]),f=JSON.stringify(f)}catch(a){f=null}q[`${d}_${u}_${v}_${w}`]={md5:e,jsCode:b[a].code,map:f}}}for(let a=0,e=C.length;a<e;a++){const e=C[a],f=E&&D[e]?D[e]:e,g=c.join(z,f),h=c.dirname(g);d.sync(h);const i=q[`${e}_${u}_${v}_${w}`];if(i&&i.jsCode){const a=i.jsCode;b.writeFileSync(g,a),i.ignored&&G.push(e),i.map&&b.writeFileSync(c.join(z,`${f}.map`),i.map)}}s(G),o()})}}(require('lazyload'),require);