'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){function a(a,b=l.GAME_JSON_CONTENT_ERR){let c=new Error(a);throw c.code=b,c}function b(a,b,c,d){c=0<c?c:1;const e=g(a,b,c);return`${d}\n${e}`}function c(b,c){const d=[];if(c.navigateToMiniProgramAppIdList){'array'!==h.getType(c.navigateToMiniProgramAppIdList)&&a(j.config.JSON_CONTENT_SHOULD_BE.format([`navigateToMiniProgramAppIdList`,'array'])),c.navigateToMiniProgramAppIdList.forEach((a,b)=>{'string'!==h.getType(a)&&d.push(j.config.JSON_CONTENT_SHOULD_BE.format([`navigateToMiniProgramAppIdList[${b}]`,'string']))});const e=b.runtimeAttr&&b.runtimeAttr.setting&&b.runtimeAttr.setting.NavigateMiniprogramLimit||n.setting.NavigateMiniprogramLimit;c.navigateToMiniProgramAppIdList.length>e&&d.push(j.config.EXCEED_LIMIT.format([`navigateToMiniProgramAppIdList`,e]))}0<d.length&&a(d.join('\n'))}function d(b,c,d){const g=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),i=_extends({},g.setting,b.runtimeAttr&&b.runtimeAttr.setting),k=[];let l='subPackages';if(d.subpackages&&(l='subpackages',d.subPackages=d.subpackages,delete d.subpackages),d.subPackages){'array'!=h.getType(d.subPackages)&&a(j.config.JSON_CONTENT_SHOULD_BE.format([l,'Array'])),d.subPackages.length>i.MaxSubPackageLimit&&a(j.config.EXCEED_LIMIT.format([l,i.MaxSubPackageLimit]));const b={},g={};d.subPackages.forEach((a,d)=>{if('undefined'!=typeof a.name&&('string'!=h.getType(a.name)&&k.push(j.config.JSON_CONTENT_SHOULD_BE.format([`${l}[${d}].name`,'String'])),b[a.name]&&k.push(j.config.JSON_CONTENT_EXISTED.format(`${l}[${d}].name`)),b[a.name]=!0),'string'!=h.getType(a.root))return void k.push(j.config.JSON_CONTENT_SHOULD_BE.format([`${l}[${d}].root`,'String']));if(0==a.root.indexOf('.'))return void k.push(j.config.JSON_SHOULD_NOT_START_WITH.format([`${l}[${d}].root`,'.']));a.root.startsWith('/')||(a.root=h.normalizePath('/'+a.root)),a.root=/\.js$/.test(a.root)?h.normalizePath(a.root):h.normalizePath(a.root+'/'),g[a.root]&&k.push(j.config.JSON_CONTENT_EXISTED.format(`${l}[${d}].root`)),g[a.root]=!0;const i=e.join(c,a.root);if(!f.existsSync(i))k.push(j.config.JSON_CONTENT_NOT_FOUND.format(`${l}[${d}].root`));else{const b=f.statSync(i);b.isDirectory()&&(!/\/$/.test(a.root)&&(a.root+='/'),!f.existsSync(e.join(i,'./game.js'))&&k.push(j.config.JSON_CONTENT_NOT_FOUND.format(`${i}game.js`)))}})}0<k.length&&a(k.join('\n'))}const e=require('path'),f=require('fs'),g=require('babel-code-frame'),h=require('./84b183688a46c9e2626d3e6f83365e13.js'),i=require('./libs/jsonlint.js').parser,j=require('./common/locales/index.js'),k=require('./162bf2ee28b76d3b3d95b685cede4146.js'),l=require('./2bc7cd511c5a7e0e403126d943b041b1.js'),m=require('./9fdd4ac31a05c27355910f0d74accd4c.js'),n=require('./6242f55dbdfe53c2f07b7a51568311f2.js');i.parseError=i.lexer.parseError=function(a,b){throw b},module.exports=async function(g){const n=await k(g),o=n.srcPath,p=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),q='game.json';let r='';try{r=n.getFile(q)}catch(b){r='',a(b.message,l.GAME_JSON_READ_ERR)}let s={};try{s=i.parse(r),s.configFrom=q}catch(c){const d=`locales.config.COMPILE_ERROR_POSTFIX.format('game.json'): Expecting ${c.expected}, got ${c.token}`,e=b(r,c.line,c.loc.first_column,d);a(e,l.GAME_JSON_PARSE_ERR)}const t=s.deviceOrientation;t&&('string'==h.getType(t)?!['portrait','landscape','landscapeLeft','landscapeRight'].includes(t)&&a(j.config.JSON_CONTENT_SHOULD_BE.format(['deviceOrientation',`"portrait", "landscape", "landscapeLeft" ${j.config.OR} "landscapeRight"`])):a(j.config.JSON_CONTENT_SHOULD_BE.format(['deviceOrientation',j.config.STRING_TYPE]))),s.networkTimeout&&'object'!=h.getType(s.networkTimeout)&&a(j.config.JSON_CONTENT_SHOULD_BE.format(['networkTimeout','Object']));const u=s.openDataContext;if(s.openDataContext||s.subContext){let b;b=(s.openDataContext||s.subContext).replace('./',''),/\/$/.test(b)||(b=`${b}/`),('/'===b||'./'===b||0===b.indexOf('.'))&&a(j.config.DIRECTORY_SETTING_NOT_LEGAL.format('subContext'),l.GAME_SUBCONTEXT_ERR);const c=e.join(b,u?'index.js':'sub.js');try{n.getFile(c)}catch(b){a(b.message,l.GAME_SUBJS_NOT_FOUND)}u?(s.openDataContext=h.normalizePath(b),s.subContext=h.normalizePath(b)):s.subContext=h.normalizePath(b)}const v=g.compileType;if(v==m.conversation||v==m.search){const a=s.widgets;let b,c='';if(!a)b=new Error(j.config.JSON_WIDGETS_EMPTY.format('game.json'));else if('array'!=h.getType(a))b=new Error(j.config.JSON_WIDGETS_NOT_ARRAY.format('game.json'));else{const d=[];a.forEach((a,b)=>{if('object'!=h.getType(a))d.push(j.config.JSON_WIDGETS_ITEM_NOT_OBJECT.format(['game.json',b]));else if('conversation'!=a.type&&'search'!=a.type)d.push(j.config.JSON_WIDGETS_TYPE_INVALID.format(['game.json',b,'conversation\u3001search']));else if(!a.path||'string'!=h.getType(a.path))d.push(j.config.JSON_WIDGETS_PATH_NOT_FOUND.format(['game.json',b]));else if(!f.existsSync(e.join(o,a.path)))d.push(j.config.JSON_WIDGETS_PATH_NOT_FOUND.format(['game.json',b]));else{const c=f.statSync(e.join(o,a.path));c.isDirectory()?!f.existsSync(e.join(o,a.path,'widget.js'))&&d.push(j.config.JSON_WIDGETS_JS_NOT_FOUND.format(['game.json',b,'widget.js'])):d.push(j.config.JSON_WIDGETS_PATH_SHOULD_BE_DIR.format(['game.json',b]))}c||a.type!=g.compileType||(c=a.path)}),c||d.push(j.config.JSON_WIDGETS_TYPE_NOT_FOUND.format(['game.json',g.compileType])),0<d.length&&(b=new Error(d.join('\n')))}if(b)throw b.code=l.GAME_JSON_CONTENT_ERR,b}return d(g,o,s),c(g,s),s}}(require('lazyload'),require);